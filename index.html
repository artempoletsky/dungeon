<!DOCTYPE html>
<html>
<head>
    <title>Memes dungeon</title>
    <link rel="stylesheet" href="src/css/dungeon.css"/>
    <script type="text/javascript" src="src/js/lib/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="src/js/lib/lodash.min.js"></script>
    <script type="text/javascript" src="src/js/lib/frontbone.js"></script>


    <script type="text/javascript" src="src/js/character_ai.js"></script>
    <script type="text/javascript" src="src/js/character.js"></script>
    <script type="text/javascript" src="src/js/spell.js"></script>
    <script type="text/javascript" src="src/js/equipment.js"></script>
    <script type="text/javascript" src="src/js/battlefield.js"></script>

    <script type="text/javascript" src="src/js/dungeon_generator.js"></script>
    <script type="text/javascript" src="src/js/dungeon.js"></script>

    <script type="text/javascript" src="src/js/dialogue.js"></script>
    <script type="text/javascript" src="src/js/game.js"></script>
    <script type="text/javascript" src="3d/babylon.2.1.js"></script>



</head>
<body>

<canvas width="800" height="600" id="canvas"></canvas>
<div id="fps"></div>
<script type="text/javascript">
    if (BABYLON.Engine.isSupported()) {
        var canvas = document.getElementById("canvas");
        var engine = new BABYLON.Engine(canvas, true);
        var divFps = document.getElementById("fps");

        var skeleton,newScene;


        //Use your file name at xxxxx
        BABYLON.SceneLoader.Load("3d/", "1.babylon", engine, function (newScene) {
            window.newScene=newScene;
            newScene.executeWhenReady(function () {

                //change the value of cameraFlag to a value other than 1 to use the free camera from blender
                var cameraFlag = 1;

                // which camera is active Arc Rotate or Blender Free Camera

                if (cameraFlag == 1){
                    var myCamera = new BABYLON.ArcRotateCamera("ArcRotateCamera", 0, 0, 0, BABYLON.Vector3.Zero(), newScene);
                    myCamera.setPosition(new BABYLON.Vector3(0, 3, -4));
                    myCamera.speed = .1;
                    myCamera.wheelPrecision = 250;
                    myCamera.fov = .8;

                    newScene.activeCamera = myCamera;

                }
                else {
                    var myCamera2 = newScene.getCameraByName("Camera");
                    myCamera2.speed = .1;
                    myCamera2.wheelPrecision = 250;
                    myCamera2.fov = .8;

                    newScene.activeCamera = myCamera2;
                }


                //newScene.scale=new BABYLON.Vector3(0.1,0.1,0.1);
                console.log(newScene);

                // Then attach the activeCamera to the canvas.
                newScene.activeCamera.attachControl(canvas);



                //newScene.activeCamera.attachControl(canvas);
                var skeleton = newScene.getSkeletonById(0);
                window.skeleton=skeleton;
                //var myBone = skeleton.bones[28].name;
                //console.log(myBone);
                //change these parameters as necessary for start and end frames of animation, looping, and speed


                newScene.beginAnimation(skeleton, 1, 11, true, 1);



                // Once the scene is loaded, just register a render loop to render it
                engine.runRenderLoop(function() {
                   divFps.innerHTML = engine.getFps().toFixed() + " fps";
                    newScene.render();
                });
            });
        }, function (progress) {
            // To do: give progress feedback to user
        });
    }



    var hitAnim=function(){
        newScene.beginAnimation(skeleton, 11, 21, false, 1, function(){
            newScene.beginAnimation(skeleton, 2, 11, true, 1);
        });
    }

    $(function(){
        $('.hit').click(hitAnim);
    });

    window.addEventListener("resize", function () {
        engine.resize();
    });
</script>

<button class="hit">hit</button>


<div class="templates">

    <div data-bind="template: character">
        <div class="character_view">
            <div class="character_image"></div>
            <div class="cv_stats">
                <div class="health_bar"></div>
            </div>
        </div>
    </div>


</div>

<form class="dungeon_generator">
    <label>Size</label>
    <select name="size">
        <option>Small</option>
        <option>Medium</option>
        <option>Big</option>
    </select>
    <label>Level</label> <input type="text" name="level" value="1"/>
    <!--label>Quest</label><select name="quest"></select-->
    <button>Start</button>
</form>

<div class="dungeon">
    <div class="team"></div>
    <div class="map">
        <div class="map_passage"></div>
    </div>
</div>

<div class="dialogs">
    <div class="cue"></div>
    <ol class="answers"></ol>
</div>


<div class="battlefield">

    <div class="hit_animation">
        <div class="left_character"></div>
        <div class="right_character"></div>
        <div class="damage"></div>
    </div>
    <ul class="info_box">
        <li><label>Atack</label> 10</li>
        <li><label>Atack</label> 10</li>
        <li><label>Atack</label> 10</li>
    </ul>
    <div class="battlefield_view clearfix">
        <div class="player_party"></div>
        <div class="monsters_party"></div>
    </div>

    <div class="turns_queue"></div>

    <div class="controls_view">

        <div class="action_points_bar">
            <div class="action_point"></div>
            <div class="action_point"></div>
            <div class="action_point"></div>
            <div class="action_point highlight"></div>
        </div>
        <div class="spells clearfix">
            <div class="spell">1</div>
            <div class="spell">2</div>
            <div class="spell">3</div>
            <div class="spell">4</div>
            <div class="spell">5</div>
        </div>
    </div>
</div>
</body>
</html>